<html>
<head>
  <title>Agree</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAMAEBAAAAEAIABoBAAANgAAACAgAAABACAAKBEAAJ4EAAAwMAAAAQAgAGgmAADGFQAAKAAAABAAAAAgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///33////2////////////////////////////////////////////////////////////////////9v///33////6///////////////////////////////////////////////////////////////////////////////6/////////////////////////////////////87ozv+/4b////////////////////////////////////////////////////////////////////////////+c0Z3/fsOA////////////////////////////////////////////////////////////////////////////nNGd/37DgP///////////////////////////////////////////////////////////////////////////5zRnf9+w4D///////////////////////////////////////////////////////////////////////////+c0Z3/fsOA////////////////////////////////////////////////////////////////////////////nNGd/37DgP///////////////////////////////////////////////////////////////////////////5zRnf9+w4D///////////////////////////////////////////////////////////////////////////+c0Z3/fsOA/////////////////////////////////////////////////////////////////7Tctf9vvHD/S6xM/0CnQf9vvHD/odSi///////////////////////////////////////////////////////6/fr/Y7dl/xuWHf8blh3/Ta1P//L58v////////////////////////////////////////////////////////////r9+v9jt2X/Ta1P//L58v//////////////////////////////////////////////////////////////////////+v36//P58///////////////////////////////////////////+v//////////////////////////////////////////////////////////////////////////////+v///33////2////////////////////////////////////////////////////////////////////9v///30AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAACAAAABAAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP///wL///97////2/////7////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+////2////3v///8C////ef///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3n////q////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86pDz/G5Yd/+Lx4v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zqkPP8blh3/4vHi////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OqQ8/xuWHf/i8eL///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86pDz/G5Yd/+Lx4v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zqkPP8blh3/4vHi////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OqQ8/xuWHf/i8eL///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86pDz/G5Yd/+Lx4v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zqkPP8blh3/4vHi////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OqQ8/xuWHf/i8eL///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86pDz/G5Yd/+Lx4v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zqkPP8blh3/4vHi////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OqQ8/xuWHf/i8eL///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////86pDz/G5Yd/+Lx4v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////zqkPP8blh3/4vHi////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////OqQ8/xuWHf/i8eL/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3/Df/8Pjw//D48P/w+PD/8Pjw/8yoTT/G5Yd/67Zrv/D48P/w+PD/8Pjw//P6c/////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/Q6hF/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/J5wp/8znzP/////////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/Q6hF/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/yecKf/M58z////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/Q6hF/xuWHf8blh3/G5Yd/xuWHf8nnCn/zOfM///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/Q6hF/xuWHf8blh3/J5wp/8znzP/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/Q6hF/yecKf/M58z////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////s9uz/0OnQ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////q////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6v///3n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////95////Av///3v////b/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7////b////e////wIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAADAAAABgAAAAAQAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8P////Wv///7X////q/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7////q////tf///1r///8PAAAAAP///w7///+T////+P////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////j///+T////Dv///1n////3///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3////Wf///8v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////y/////r/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////W7Nb/ks2T/43Kjv+43rj/+v36//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+s2a3/Jpsn/xuWHf9wvXH/9fr1//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////r9+v/r9uv/6/br/+v26//r9uv/6/br/+v26/+g06D/JZon/xuWHf9pumr/4vLi/+v26//r9uv/6/br/+v26//r9uv/8vny/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+n16v95wXr/Ua9T/1GvUv9Rr1L/Ua9S/1GvUv89pj//Hpcg/xuWHf8vnzH/T65Q/1GvUv9Rr1L/Ua9S/1GvUv9dtV//w+PD//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3+/f/G5cf/M6E1/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/yKZJP+Ny47/9vv2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yufL/zOhNf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/Ipkk/4DFgf/6/fr//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8blx/9DqEX/G5Yd/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/xuWHf8nnCn/jcuO//r9+v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3+/f/G5cf/M6E1/xuWHf8blh3/G5Yd/xuWHf8blh3/G5Yd/yKZJP+Ny47/9vv2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yufL/zOhNf8blh3/G5Yd/xuWHf8blh3/Ipkk/4DFgf/6/fr//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8blx/9DqEX/G5Yd/xuWHf8nnCn/jcuO//r9+v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3+/f/G5cf/M6E1/yKZJP+Ny47/9vv2////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////yufL/4XHhf/6/fr///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////r/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+v///8v/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////y////1n////3///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3////Wf///w7///+T////+P////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////j///+T////DgAAAAD///8P////Wv///7X////q/////v////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7////q////tf///1r///8PAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==">
  <style>
    {style}
  </style>
</head>
<body>

{content}

<script>
  const $ = document.querySelectorAll.bind(document);
  const storedToken = localStorage.getItem('token');
  const loginFormHTML = $('.login-form')[0].innerHTML;

  if (storedToken) {
    loadProfile(storedToken);
  }
  else {
    $('.login-form')[0].style.opacity = 1;
  }

  function loadProfile(token) {
    fetch(`/profile?token=${token}`)
    .then((response) => {
      console.log(response);
      if (response.status === 404) { throw new Error('Invalid token'); }
      return response.json();
    })
    .then((profile) => {
      console.log('Loaded profile: ', profile);
      showProfile(profile);
      showVotes(profile.votes);
      setToken(token);
    })
    .catch((err) => {
      alert('There was an error logging you in: ' + err.message);
      logout();
    });
  }

  function showVotes(votes) {
    votes.forEach((vote) => {
      $(`.claim[id="claim-${vote['claim-id']}"] .vote.${vote.direction} .vote-button`).forEach((voteButton) => {
        voteButton.className += ' voted';
      });
    });
  }

  function setToken(token) {
    localStorage.setItem('token', token);
    $('input[type="hidden"][name="token"]').forEach((el) => el.value = token);
  }

  function showProfile({username, score}) {
    $('.login-form')[0].innerHTML = `
      <p class="profile">${username} (score: ${score.karma}, streak: ${score.streak})
        <a href="#" onclick="logout(event)">Log out</a></p>`;

    $('.login-form')[0].style.opacity = 1;
  }

  function hideProfile() {
    $('.login-form')[0].innerHTML = loginFormHTML;
  }

  function login(e) {
    e.preventDefault();
    const token = document.getElementById('token').value.trim();
    console.log('Logging in token', token);
    loadProfile(token);
  }

  function logout(e) {
    if (e) { e.preventDefault(); }
    $('input[type="hidden"][name="token"]').forEach((el) => el.value = '');
    localStorage.removeItem('token');
    hideProfile();
  }

  function onClaimChange() {
    const claimText = $('.claim-form [name="text"]')[0];

    if (claimText.value.trim().length === 0) {
      e.preventDefault();
      alert('Cannot submit blank claim');
    }
  }
</script>
</body>
</html>